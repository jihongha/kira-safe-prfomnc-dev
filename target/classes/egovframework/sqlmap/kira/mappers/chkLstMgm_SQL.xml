<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.kira.safe.prfomnc.admin.chkLstMgm.service.impl.ChkLstMgmMapper">
	
	<!-- 한국건축규정 체크리스트 항목관리 등록처리 -->
	<insert id="insertKppLawordMgmExec" parameterType="hashMap">
		 <selectKey keyProperty="lawordSeqNo" resultType="int" order="BEFORE">
        	SELECT 
        		IFNULL(MAX(LAWORD_SEQ_NO) + 1, 1) AS LAWORD_SEQ_NO
        	FROM 
        		KPP_LAWORD_MGM
    	</selectKey>
    	
		INSERT INTO KPP_LAWORD_MGM
		(
			LAWORD_SEQ_NO
			,LAWORD_TY
			,LAWORD_NM
			,LAWORD_LRG_NM
			,LAWORD_LRG_LINK_PATH
			,FILE_GRP_ID
			,USE_AT
			,FIRST_WRTR_ID
			,FIRST_CRTN_DT
			,LAST_UPDUSR_ID
			,LAST_UPDT_DT
		)
		VALUES
		(
			#{lawordSeqNo},
			#{lawordTy}, 
			#{lawordNm},
			#{lawordLrgNm}, 
			#{lawordLrgLinkPath}, 
			'', 
			'Y', 
			'SYSTEM', 
			DATE_FORMAT(SYSDATE(), '%Y%m%d%H%I%S'), 
			'SYSTEM', 
			DATE_FORMAT(SYSDATE(), '%Y%m%d%H%I%S')
		);
	</insert>
	
	<!-- 한국건축규정 체크리스트 항목관리 목록조회 -->
	<select id="selectKppLawordMgmListInfo" parameterType="hashMap" resultType="egovMap">
		<![CDATA[
		SELECT 
			LAWORD_SEQ_NO
			,LAWORD_TY
			,(
				SELECT
					CD_DESC
				FROM
			 		CMP_COMM_CD_MGM		CCCM
			 	WHERE
			 		USE_AT				=		'Y'
			 	AND
			 		LGRP_CD				=		'KR001' 
			 	AND
			 		CCCM.SGRP_CD		=		KLM.LAWORD_TY
			 	AND
			 		DATE_FORMAT(SYSDATE(), '%Y%m%d')	BETWEEN		APPLY_STRT_DT		AND		APPLY_EXP_DT
			 			
			)	AS	LAWORD_TY_NM
			,LAWORD_NM
			,LAWORD_LRG_NM
			,LAWORD_LRG_LINK_PATH
			,FILE_GRP_ID
			,USE_AT
			,FIRST_WRTR_ID
			,FIRST_CRTN_DT
			,LAST_UPDUSR_ID
			,LAST_UPDT_DT
		FROM 
			KPP_LAWORD_MGM KLM
		WHERE
			USE_AT				=		'Y'
		]]>
	</select>
	
	
	<!-- 한국건축규정 체크리스트 항목관리 상세조회 -->
	<select id="selectKppLawordMgmInfo" parameterType="hashMap" resultType="egovMap">
		<![CDATA[
		SELECT 
			LAWORD_SEQ_NO
			,LAWORD_TY
			,(
				SELECT
					CD_DESC
				FROM
			 		CMP_COMM_CD_MGM		CCCM
			 	WHERE
			 		USE_AT				=		'Y'
			 	AND
			 		LGRP_CD				=		'KR001' 
			 	AND
			 		CCCM.SGRP_CD		=		KLM.LAWORD_TY
			 	AND
			 		DATE_FORMAT(SYSDATE(), '%Y%m%d')	BETWEEN		APPLY_STRT_DT		AND		APPLY_EXP_DT
			 			
			)	AS	LAWORD_TY_NM
			,LAWORD_NM
			,LAWORD_LRG_NM
			,LAWORD_LRG_LINK_PATH
			,FILE_GRP_ID
			,USE_AT
			,FIRST_WRTR_ID
			,FIRST_CRTN_DT
			,LAST_UPDUSR_ID
			,LAST_UPDT_DT
		FROM 
			KPP_LAWORD_MGM KLM
		WHERE
			USE_AT				=		'Y'
		AND
			LAWORD_SEQ_NO		=		#{lawordSeqNo}
		]]>
	</select>
	
</mapper>